CC=@CC@
CFLAGS=-std=c99 -O3 -Wall -Wextra -Wpedantic
SOURCES=./waveplot.c ./audio.c ./file.c ./info.c ./dr.c
SRC_PATH=.
BUILD_PATH=build
PREFIX=@prefix@

INSTALL=@INSTALL@

OBJECTS=$(SOURCES:$(SRC_PATH)/%.c=$(BUILD_PATH)/%.o)

$(BUILD_PATH)/%.o: $(SRC_PATH)/%.c
	$(CC) -c -fPIC $(CFLAGS) -o $@ $<

libwaveplot: dirs $(OBJECTS)
	$(CC) -shared -Wl,-soname,libwaveplot.so.1.0 -o $(BUILD_PATH)/libwaveplot.so.1.0 $(OBJECTS) -lm -lavutil -lavcodec -lavformat -lavresample

test: libwaveplot
	$(CC) $(CFLAGS) test.c -o $(BUILD_PATH)/test -lwaveplot

.PHONY: dirs
dirs:
	@mkdir -p $(dir $(OBJECTS))

.PHONY: install
install:
	@$(INSTALL) $(BUILD_PATH)/libwaveplot.so.1.0 $(PREFIX)/lib

.PHONY: uninstall
uninstall:
	@$(RM) $(PREFIX)/lib/libwaveplot.so.1.0

.PHONY: clean
clean:
	@echo "Cleaning build directory."
	@$(RM) $(BUILD_PATH)/*.o
